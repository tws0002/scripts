<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
    <meta http-equiv="pragma" content="no-cache"/>
    <script src="/assets/scripts/adobe_scripts/jquery-1.9.1.min.js"></script>
    <!-- <link rel="stylesheet" href="/assets/scripts/adobe_scripts/reset.css"> -->
    <!-- <link rel="stylesheet" href="/assets/scripts/animate/animate.min.css"> -->


    <script type="text/javascript" src="/assets/scripts/js-cookie/src/js.cookie.js"></script>

    <script>var $j = jQuery.noConflict();</script>
    <script src="/assets/scripts/adobe_scripts/CSInterface.js" type="text/javascript"></script>
    <script src="/assets/scripts/jquery_contextmenu/src/jquery.ui.position.js" type="text/javascript"></script>
    <script src="/assets/scripts/jquery_contextmenu/src/jquery.contextMenu.js" type="text/javascript"></script>
    <script src="/assets/scripts/jquery_contextmenu/screen.js" type="text/javascript"></script>
    <script src="/assets/scripts/jquery_contextmenu/prettify/prettify.js" type="text/javascript"></script>
    <link href="/assets/scripts/jquery_contextmenu/src/jquery.contextMenu.css" rel="stylesheet" type="text/css" />

    <script src="/context/spt_js/mootools/mootools-core-1.4.1-full-nocompat-yc.js?ver=4.1.0.v03"></script>
    <script src="/context/spt_js/mootools/mootools-more-1.4.0.1-yc.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/json2.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/spt_init.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/effects.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/utility.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/dynamic_css.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/xmlrpc.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/api/utility.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/environment.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/applet.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/client_api.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/mouse.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/keyboard.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/events.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/behavior.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/panel.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/js_logger.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/page_utility_widgets.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/validation.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/custom_project.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/spt_onload_startup.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/api/api.js?ver=4.1.0.v03" ></script>
    <script src="/context/spt_js/load-image.min.js?ver=4.1.0.v03" ></script>
    <style>
        body {
            font-family: helvetica, arial, "細明體";
            color: #b1b1b1;
            background-color: #323232;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
            -webkit-border-radius: 10px;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            -webkit-border-radius: 10px;
            border-radius: 10px;
            background: #F39814;
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
        }
        ::-webkit-scrollbar-thumb:window-inactive {
            background: #F39814;
        }

        ::-webkit-scrollbar-button {
            background-size: 100%;
            background-color: #F39814;
            height: 10px;
            width: 10px;
            -webkit-box-shadow: inset 1px 1px 2px rgba(0,0,0,0.2);
        }

        ::-webkit-scrollbar-button:end:increment {
            /*background-image: url(../../adobe_scripts/icons/chevron-down.png);*/
        }


        input{
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
        }

        tr, td{
            border: 1px dotted #444;
        }
        button {
            display: inline;
            cursor: pointer;
            border: 1px solid #111;
            background: linear-gradient(to bottom, #525252, #484848);
            border-radius: 3px;
            height: 24px;
            color: #b1b1b1;
        }

        button:hover {
            border: 2px solid #F39814;
        }


        .selectable .ui-selected { background: #F39814; color: white; }
        .selectable { width: inherit; height: 90%; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; display: inline-block; background: linear-gradient(to bottom, #4d4d4d , #646464 10%, #5d5d5d); }
        .selectable li { margin: 1px; padding: 0px; font-size: 11px;}
        .selectable li:hover {
            background: #F39814;
            color: black;
        }
        .selectable .ui-selectee { margin: 0px; padding: 0px; font-size: 12px;}

        .panel {
            display: inline-block;
            width: 175px;
            height: 200px;
        }

        .full_panel {
            width: 100%;
            height: 150px;
            display: inline-block;
        }

        .panel_label {
            font-size: 12px;
            margin: 0 auto;
            display: block;
            text-align: center;
            padding: 3px;
        }

        }
        .tab {
            display: inline-block;
            margin: auto;
            width: 100%;
            height: 10%;
        }
        .tab_label {
            font-size: 12px;
            display: inline-block;
            border-top: 1px solid #555;
            border-left: 1px solid #555;
            border-right: 1px solid #555;
            padding: 5px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }
        .assets_tab{
        }
        .shots_tab{
            color: #444;
        }

        .top{
            display: block;
        }
        .inline{
            display: inline-block;
            height: 100%;
            vertical-align: middle;
        }

        .button{
            display: inline;
            cursor: pointer;
            border: 1px solid #111;
            background: linear-gradient(to bottom, #525252, #484848);
            border-radius: 3px;
            height: 26px;
            box-sizing: border-box;
        }

        .button:hover{
            border: 2px solid #F39814;
            height: 26px;
            -webkit-filter: grayscale(0%) brightness(100%);

        }

        .button_on{
            border: 2px solid #F39814;
        }

        .button_off{
            -webkit-filter: grayscale(100%) brightness(50%);
        }

        .sign_out {
            float: right;
        }

        #login_name{
            float: right;
            padding: 6px;
        }


        #asset_process_panel{
            width: 90px;
        }

        #shot_process_panel{
            width: 90px;
        }

        .mainUI{
            display: none;
        }

        .loginUI{

        }

        .text_label{
            text-align: right;
            display: inline-block;
            font-size: 12px;
            vertical-align: middle;
            width: 16%;
        }

        .text_input{
            background: linear-gradient(to bottom, #4d4d4d , #646464 10%, #5d5d5d);
            color: #b1b1b1;
            font-size: 10px;
            line-height: 22px;
            vertical-align: middle;
            width: 75%;
            border: 1px solid #111111;
            border-radius: 3px;
        }

        .tool_output{
            width: 100%;
            background: linear-gradient(to bottom, #4d4d4d , #646464 10%, #5d5d5d);
            color: #b1b1b1;
            font-size: 10px;
            line-height: 22px;
            vertical-align: middle;
            border: 1px solid #111111;
            border-radius: 3px;
        }

        .text_button{
            display: block;
            width: 100%;
            margin: auto;
            height: 26px;
        }

        .row_div{
            margin: 2px auto;
            width: 100%;
            text-align: center;
            display: block;
        }

        .row_div_label{
            font-size: 12px;
            margin: auto;
            text-align: center;
        }

        .process_status{
            vertical-align: middle;
            margin-left: 1px;
            margin-right: 2px;
        }

        .datetime {
            margin-right: 10px;
            display: inline;
        }

        .filename {
            display: inline;
        }

        .info {
            font-size: 12px;
        }

        .info_label{
            width: 20%;
            text-align: center;
            background-color: #323232;
        }

        .info_data{
            display: block;
        }

        .info_data div{
            width: 100%;
            height: 14px;
            margin: auto;
            text-align: center;
            overflow: hidden;
        }

        .info table{
            width: 100%;
            border-spacing: 1px;
            background: linear-gradient(to bottom, #4d4d4d , #646464 10%, #5d5d5d);
        }

        .tool_info_out{
            padding: 10px;

        }

        .tool_info_in{
            border: 1px dotted #444;
        }
    </style>
</head>

<body>
<div class='loginUI'>
<form name="loginform" enctype="multipart/form-data">
    <input id='login' class='text' type="text" name="usr" placeholder="username">
    <input id='password' class='text' type="password" name="pword" placeholder="password">
    <button class='text' type="button" onclick='javascript:validateForm()'
    label='Submit'>Submit</button>
</form>
</div>

<div class='mainUI'>
<table>
    <tr>
        <td colspan='3'>
            <div class='top'>
                <div class='inline'>
                    <img src="/assets/scripts/adobe_scripts/icons/play.png" class='button button_on proj_status' name='inprogress'/>
                    <img src="/assets/scripts/adobe_scripts/icons/pause.png" class='button button_off proj_status' name='standby'/>
                    <img src="/assets/scripts/adobe_scripts/icons/check.png" class='button button_off proj_status' name='complete'/>
                </div>
                <img src="/assets/scripts/adobe_scripts/icons/oi-login.png" class='button button_on sign_out'></img>
                <div id='login_name'></div>

            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class='panel '>
                <div class='tab'>
                    <div class='tab_label'>Projects</div>
                </div>
                <ul class='selectable' id='projects'></ul>
            </div>
        </td>
        <td>
            <div class='panel ' id='asset_panel'>
                <div class='tab'>
                    <div class='tab_label assets_tab'>Assets</div>
                    <div class='tab_label shots_tab'>Shots</div>
                </div>
                <ul class='selectable' id='assets'></ul>
            </div>
            <div class='panel' id='shot_panel'>
                <div class='tab'>
                    <div class='tab_label assets_tab'>Assets</div>
                    <div class='tab_label shots_tab'>Shots</div>
                </div>
                <ul class='selectable' id='shots'></ul>
            </div>
        </td>
        <td>
            <div class='panel ' id='asset_process_panel'>
                <div class='tab'>
                    <div class='tab_label'>Process</div>
                </div>
                <ul class='selectable' id='asset_process'></ul>
            </div>
            <div class='panel' id='shot_process_panel'>
                <div class='tab'>
                    <div class='tab_label'>Process</div>
                </div>
                <ul class='selectable' id='shot_process'></ul>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div class='info' id='project_info'>
                <table>
                    <tr>
                        <td class='info_label'>專案</td>
                        <td class='info_data'><div id='game_name_chn'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>案型</td>
                        <td class='info_data'><div id='game_type'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>窗口</td>
                        <td class='info_data'><div  id='game_assigned'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>開始</td>
                        <td class='info_data'><div id='game_bsd'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>結束</td>
                        <td class='info_data'><div id='game_bed'></div></td>
                    </tr>
                </table>
            </div>
        </td>
        <td colspan='2'>
            <div class='info' id='item_info'>
                <table>
                    <tr>
                        <td class='info_label'>物件</td>
                        <td class='info_data'><div id='item_name_chn'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>類型</td>
                        <td class='info_data'><div id='item_type'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>分配</td>
                        <td class='info_data'><div id='item_task_assigned'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>開始</td>
                        <td class='info_data'><div id='item_task_bsd'></div></td>
                    </tr>
                    <tr>
                        <td class='info_label'>結束</td>
                        <td class='info_data'><div id='item_task_bed'></div></td>
                    </tr>
                </table>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan='3'>
            <div class='row_div'>
                <div class='text_label' id='final_path_label'>存檔路徑:</div>
                <input class='text_input' id="final_path" autofocus value="value text" onfocus="this.value = this.value;" spellcheck="false"/>
                <div class='inline'>
                    <img src="/assets/scripts/adobe_scripts/icons/fa-folder-open-o.png" class='button' id='open_folder' onclick='javascript:tacticUI.openFolder()'/>
                </div>
            </div>
            <div class='row_div'>
                <div class='text_label' id='final_file_label'>存檔名:</div>
                <input class='text_input' id="final_file_name"/>
                <div class='inline'>
                    <img src="/assets/scripts/adobe_scripts/icons/fa-save.png" class='button' id='save_file' onclick='javascript:tacticUI.saveFile()'/>
                </div>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan='3'>
            <div class=''>
                <div class='text_label' id='final_file_label'>TESTING:</div>
                <input class='text_input' id="testing"/>
            </div>
        </td>
    </tr>
<!--     <tr>
        <td colspan='3'>
        <div class=''>
                <button class='text_button' onclick='javascript:tacticUI.saveFile()'>Save</button>
            </div>
        </td>
    </tr> -->
<!--     <tr>
        <td colspan='3'>
        <div class=''>
                <button class='text_button' onclick='javascript:tacticUI.test()'>test</button>
            </div>
        </td>
    </tr> -->
    <tr>
        <td colspan='3'>
            <div class='full_panel '>
                <div class='panel_label'>
                    檔案
                </div>
                <ul class='selectable' id='files'></ul>
            </div>
            <div class='row_div'>
                <button class='text_button' onclick='javascript:tacticUI.openFile()'>開啟</button>
            </div>
             <div class='row_div'>
                <div class='row_div_label'>檔案過濾</div>
            </div>
            <div class='row_div'>
                <img src="/assets/scripts/adobe_scripts/icons/adobe_cc_ps_icon_off.png" class='button button_off app' name='PHXS'/>
                <img src="/assets/scripts/adobe_scripts/icons/adobe_cc_ae_icon_off.png" class='button button_off app' name='AEFT'/>
                <img src="/assets/scripts/adobe_scripts/icons/adobe_cc_ai_icon_off.png" class='button button_off app' name='ILST'/>
                <img src="/assets/scripts/adobe_scripts/icons/adobe_cc_fl_icon_off.png" class='button button_off app' name='FLPR'/>
                <img src="/assets/scripts/adobe_scripts/icons/maya_icon_off.png" class='button button_off app' name='MAYA'/>
                <img src="/assets/scripts/adobe_scripts/icons/max_icon_off.png" class='button button_off app' name='MAX'/>
                <img src="/assets/scripts/adobe_scripts/icons/nuke_icon_off.png" class='button button_off app' name='NUKE'/>
            </div>
        </td>
    </tr>
    <tr>
        <td colspan='3'>
            <div class='row_div'>
                <div class='row_div_label'>工具</div>
            </div>
            <div class='row_div'>
                    <img src="/assets/scripts/adobe_scripts/icons/tactic_icon.png" class='button' onclick='javascript:tacticUI.uploadTactic()'/>
                    <img src="/assets/scripts/adobe_scripts/icons/qc_icon.png" class='button' onclick='javascript:tacticUI.uploadQc()'/>
                    <img src="/assets/scripts/adobe_scripts/icons/fa-folder-open-o.png" class='button' onclick='javascript:tacticUI.openQc()'/>
            </div>
<!--             <div class='row_div'>
                <div class='text_label' id='qc_path_label'>QC路徑:</div>
                <input class='text_input' id="qc_path" autofocus value="value text" onfocus="this.value = this.value;" spellcheck="false"/>
                <div class='inline'>
                    <img src="/assets/scripts/adobe_scripts/icons/fa-folder-open-o.png" class='button' id='open_folder' onclick='javascript:tacticUI.openQCFolder()'/>
                </div>
            </div> -->

        </td>
    </tr>
</table>

</div>
    <script>
        var tacticUI = new mainWindow();

        var ua = navigator.userAgent.split(" ");
        for(i=0;i<ua.length;i++){
            if(ua[i].indexOf('Chrome') > -1){
                var browser_version = parseInt(ua[i].split("/")[1].split(".")[0]);
            }
        }

        if(browser_version < 48){
            var CSLibrary = new CSInterface();
            tacticUI.setAppId();
            /*$j('#testing').val('should be inside adobe');*/
        }
        else {
            /*$j('#testing').val('should be inside chrome');*/
        }

        function validateForm() {
            var un = document.loginform.usr.value;
            var pw = document.loginform.pword.value;
            try {
                ticket = server.get_ticket(un,pw);
                Cookies.set('login', un);
                Cookies.set('password', pw);
                server.set_ticket(ticket);
                $j('.mainUI').css('display','block');
                $j('.loginUI').css('display','none');
                $j('#login_name').text(un);
                server.login = un;
                ok();
            }
            catch(err){
                alert(un, pw, ticket);
            }
        }

        function ok(){
            if(ticket){
                tacticUI.getProjects();
                $j('.mainUI').css('display','block');
                $j('.loginUI').css('display','none');
                $j('#login_name').text(server.login);
            }
        }

        $j("input").keypress(function(event) {
            if (event.which == 13) {
                event.preventDefault();
                validateForm();
            }
        });

        var server = TacticServerStub.get();
        server.set_url("/tactic/default/Api/");
        server.set_project("simpleslot");
        login = Cookies.get('login');
        password = Cookies.get('password');
        login = 'julio';
        password = '1234';
        server.login = login;

        try {
            ticket = server.get_ticket(login,password);
            server.set_ticket(ticket);
            ok();
        }
        catch(err){
            $j('.mainUI').css('display','none');
            $j('.loginUI').css('display','block');
        }

        $j('#shot_panel').css('display','none');
        $j('#shot_process_panel').css('display','none');
        production_type = 'assets';

        $j('.assets_tab').on('click', function(event, ui) {
            production_type = 'assets';
            $j('.shots_tab').css('color', '#444');
            $j('.assets_tab').css('color','#b1b1b1');
            $j('#shot_panel').css('display','none');
            $j('#asset_panel').css('display','');
            $j('#shot_process_panel').css('display','none');
            $j('#asset_process_panel').css('display','');
        });

        $j('.shots_tab').on('click', function(event, ui) {
            production_type = 'shot';
            $j('.shots_tab').css('color', '#b1b1b1');
            $j('.assets_tab').css('color','#444');
            $j('#shot_panel').css('display','');
            $j('#asset_panel').css('display','none');
            $j('#shot_process_panel').css('display','');
            $j('#asset_process_panel').css('display','none');
            tacticUI.getItems();
        });

        $j('img.proj_status').on('click', function(event, ui){
            $j('.inline img.button_on').removeClass('button_on').addClass('button_off');
            $j(this).addClass('button_on').removeClass('button_off');
            filter = $j(this).attr('name');
            tacticUI.getProjects();
        });

        $j('img.app').on('click', function(event, ui){
            if($j(this).hasClass('button_on') == true){
                tacticUI.resetAppFilter();
                img = $j(this).attr('src');
                on_img = img.replace("icon.png","icon_off.png");
                $j(this).attr('src',on_img);

            } else if($j(this).hasClass('button_off') == true){
                tacticUI.resetAppFilter();
                $j(this).addClass('button_on').removeClass('button_off');
                img = $j(this).attr('src');
                off_img = img.replace("_off.png","") + ".png";
                $j(this).attr('src',off_img);
            }
            /*tacticUI.appId = $j(this).attr('name');*/
            tacticUI.appId = '';
            tacticUI.getFiles();

        });

        $j('.sign_out').on('click', function(event, ui){
                $j('.mainUI').css('display','none');
                $j('.loginUI').css('display','block');
        });



    function mainWindow(){
        filter = 'inprogress';
        var self = this;
        self.asset_item_details = '';
        self.shot_item_details = '';
        self.server = '';
        self.item_tasks = '';

        self.game;
        self.projects_data = [];
        self.project_info = [];

        self.item_details = "";

        self.item_task_details = "";
        self.process = "";

        self.final_path = "";
        self.base_filename = "";
        self.save_filename = "";
        self.current_filename = "";

        self.file_list = "";
        self.appId = "";
        self.osInfo = "";

        self.next_version = 1;
        self.current_version = 1;
    /*    self.item_process = '';
        self.item_code = '';
        self.assigned = '';
        self.bsd = '';
        self.bed = '';
        self.sk = '';
        self.processes = '';
    */
        self.asset_process_list = [];
        self.shot_process_list = [];

        self.cftype = ['sports', 'cf', 'video_conf', 'database', 'lottery'];

        self.buildList = function(alist){
            flist = "";
            for(y=0;y<alist.length;y++){
                flist = flist + "<li>" + alist[y] + "</li>";
            }
            return flist;
        }


        self.getProjects = function(){
            $j('#projects').empty();

            if(filter == 'inprogress'){
                filter_id = "['id','8']";
            }
            else if(filter == 'standby'){
                filter_id = "['id','10']";
            }
            else if(filter == 'complete'){
                filter_id = "['id','11']";
            }
            else {
                filter_id = "";
            }

            expr = "@SOBJECT(simpleslot/plan['begin']" + filter_id + "['or'])"
            temp = server.eval(expr)[0];
            names = bsd = bed = names_chn = game_type = assigned = "";

            names = temp['name'].split('__');
            names.shift();
            bsd = temp['login'].split('__');
            bsd.shift();
            bed = temp['keywords'].split('__');
            bed.shift();
            names_chn = temp['game_name_chn'].split('__');
            names_chn.shift();
            game_type = temp['description'].split('__');
            game_type.shift();
            assigned = temp['process'].split('__');
            assigned.shift();


            for(x=0;x<names.length;x++){
                data = {'name': names[x], 'bsd': bsd[x], 'bed': bed[x], 'game_name_chn': names_chn[x], 'game_type': game_type[x], 'assigned': assigned[x]};
                self.projects_data.push(data);
            }

            names = names.sort();

            project_list = "";
            for(i=0;i<names.length;i++){
                project_list = project_list + "<li>" + names[i] + "</li>";
            }
            $j('ul.selectable#projects').append(project_list);

            /* bind behavior */
            $j('.selectable#projects li').on('click', function( event, ui ) {
                $j('.selectable li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");
                self.game = $j(this).text();
                self.getItems();
            });

            /* select default */
            selected = $j('ul.selectable#projects li.ui-selected');
            if(selected.length == 0) {
                temp = $j("ul.selectable#projects li:contains('jia_test')");
                $j(temp).addClass('ui-selected');
                self.game = $j(temp).text();
                self.getItems();
            }
        }

        self.getItems = function(){
            for(x=0;x<self.projects_data.length;x++){
                if(self.game == self.projects_data[x]['name']){
                    if(self.projects_data[x]['game_type'] == 'casino'){
                        self.project_info = self.projects_data[x];
                        self.updateAssetList(stype="3d");
                    }
                    else if(self.cftype.indexOf(self.projects_data[x]['game_type']) >= 0){
                        self.project_info = self.projects_data[x];
                        shot_panel_selected = $j('.panel#shot_panel').css(['display']).display;
                        asset_panel_selected = $j('.panel#asset_panel').css(['display']).display;
                        if(asset_panel_selected != 'none'){
                            self.updateAssetList(stype="assets");
                        }
                        if(shot_panel_selected != 'none'){
                            self.updateShotList(stype="shot");
                        }
                    }
                }
            }
        }

        self.updateAssetList = function(stype){
            $j('#assets').empty();
            $j('#shots').empty();

            assets = []; /*array for sorting*/
            asset_list = ""; /*long string for insertion into dom*/
            self.asset_item_details = [];

            expr = "@SOBJECT(simpleslot/game['name','" + self.game + "'].simpleslot/" + stype + ")";
            self.asset_item_details = server.eval(expr);

            for(y=0;y<self.asset_item_details.length;y++){
                assets.push(self.asset_item_details[y]['name']);
            }
            assets = assets.sort();

            asset_list = self.buildList(assets);

            $j('ul.selectable#assets').append(asset_list);

            $j('.selectable#assets li').on('click', function( event, ui ) {
                $j('.selectable#assets li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");

                for(z=0;z<self.asset_item_details.length;z++){
                    if($j(this).text() == self.asset_item_details[z]['name']){
                        self.item_details = self.asset_item_details[z];
                    }
                }
                self.getAssetProcess(stype);
            });

            /*set default item to first in list*/
            if($j('.selectable#assets li.ui-selected').length == 0) {
                selected = $j('.selectable#assets li')[0];
                $j('.selectable#assets li').removeClass("ui-selected");
                $j(selected).addClass("ui-selected");
                for(z=0;z<self.asset_item_details.length;z++){
                    if($j(selected).text() == self.asset_item_details[z]['name']){
                        self.item_details = self.asset_item_details[z];

                    }
                }
                self.getAssetProcess(stype);
            }

        }

        self.updateShotList = function(stype){
            $j('#shots').empty();
            shots = []; /*array for sorting*/
            shot_list = ""; /*long string for insertion into dom*/
            self.shot_item_details = [];

            expr = "@SOBJECT(simpleslot/game['name','" + self.game + "'].simpleslot/shot)";
            self.shot_item_details = server.eval(expr);

            for(y=0;y<self.shot_item_details.length;y++){
                shots.push(self.shot_item_details[y]['name']);
            }
            shots = shots.sort();

            shot_list = self.buildList(shots);

            $j('ul.selectable#shots').append(shot_list);

            $j('.selectable#shots li').on('click', function( event, ui ) {
                $j('.selectable#shots li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");

                for(z=0;z<self.shot_item_details.length;z++){
                    if($j(this).text() == self.shot_item_details[z]['name']){
                        self.item_details = self.shot_item_details[z];
                    }
                }
                self.getShotProcess(stype);
            });

            /*set default item to first in list*/
            if($j('.selectable#shots li.ui-selected').length == 0) {
                selected = $j('.selectable#shots li')[0];
                $j('.selectable#shots li').removeClass("ui-selected");
                $j(selected).addClass("ui-selected");

                for(z=0;z<self.shot_item_details.length;z++){
                    if($j(selected).text() == self.shot_item_details[z]['name']){
                        self.item_details = self.shot_item_details[z];
                    }
                }
                self.getShotProcess(stype);
            }
        }

        self.addContextMenu = function(stype){
            $j('.selectable#asset_process').contextMenu({
                selector: 'li',
                callback: function(key, options) {
                    /*var m = "clicked: " + key + " on " + $j(this).text();
                    window.console && console.log(m) || alert(m); */
                    for(i=0;i<self.item_tasks.length;i++){
                        if(self.item_tasks[i]['process'] == $j(this).text()){
                            sk = self.item_tasks[i]['__search_key__'];
                            key = '.' + key;
                            data = {'status': key};
                            server.update(sk, data);
                            self.getAssetProcess(stype);
                            break;
                        }
                    }

                },
                items: {
                    "Not Ready": {name: "Not Ready", icon: "notready"},
                    "Ready": {name: "Ready", icon: "ready"},
                    "In Progress": {name: "In Progress", icon: "inprogress"},
                    "Stand By": {name: "Stand By", icon: "standby"},
                    "Review": {name: "Review", icon: "review"},
                    "sep1": "---------",
                    "Complete": {name: "Complete", icon: "complete"}
                }
            });
        }

        self.getAssetProcess = function(stype){
            expr = "@SOBJECT(simpleslot/" + stype + "['code','" + self.item_details['code'] + "'].sthpw/task)";
            self.item_tasks = server.eval(expr);

            asset_process_list = ""; /* long string for insertion into dom */

            $j('.selectable#asset_process').empty();
            $j('.selectable#shot_process').empty();

            ordered = ['rough', 'concept', 'model','texture','rigging','animation','lighting','effects','layout','final']

            for(order=0;order<ordered.length;order++){
                for(task = 0; task < self.item_tasks.length; task++){
                    if(self.item_tasks[task]['process'] == ordered[order]){
                        self.item_task_details = self.item_tasks[task];
                        process = self.item_tasks[task]['process'];
                        status = self.item_tasks[task]['status'];
                        status_icon = "<img src=" + self.statusIcon(status) + ">";
                        asset_process_list = asset_process_list + "<li>" +self.statusIcon(status) + process + "</li>";
                    }
                }
            }

            $j('ul.selectable#asset_process').append(asset_process_list);

            /*bind click behavior*/
            $j('.selectable#asset_process li').on('click', function( event, ui ) {
                $j('.selectable#asset_process li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");
                self.process = $j(this).text();
                self.finalPath(production_type = 'assets', stype = stype);
                for(i=0;i<self.item_tasks.length;i++){
                    if(self.item_tasks[i]['process'] == self.process){
                        self.item_task_details = self.item_tasks[i];
                        break;
                    }
                }
            });

            /*select default*/
            selectedProcess = self.process;

            if($j('.selectable#asset_process li.ui-selected').length == 0){ //if nothing is selected
                selector = '.selectable#asset_process li:contains(\"' + selectedProcess + '\")';
                if($j(selector).length == 0){
                    if($j('.selectable#asset_process li').length > 0){
                        $j('.selectable#asset_process li')[0].addClass("ui-selected");
                    }
                } else {
                    $j(selector).addClass("ui-selected");
                }
                self.process = $j('.selectable#asset_process li.ui-selected').text();
                self.finalPath(production_type = 'assets', stype = stype);
                for(i=0;i<self.item_tasks.length;i++){
                    if(self.item_tasks[i]['process'] == self.process){
                        self.item_task_details = self.item_tasks[i];
                        break;
                    }
                }
            }
            self.addContextMenu(stype);
        }

        self.getShotProcess = function(stype){
            expr = "@SOBJECT(simpleslot/shot['code','" + self.item_details['code'] + "'].sthpw/task)";
            self.item_tasks = server.eval(expr);

            shot_process_list = ""; /* long string for insertion into dom */

            $j('.selectable#shot_process').empty();

            ordered = ['layout','animation','lighting','effects','comp','final']

            for(order=0;order<ordered.length;order++){
                for(task = 0; task < self.item_tasks.length; task++){
                    if(self.item_tasks[task]['process'] == ordered[order]){
                        self.item_task_details = self.item_tasks[task];
                        process = self.item_tasks[task]['process'];
                        status = self.item_tasks[task]['status'];
                        status_icon = "<img src=" + self.statusIcon(status) + ">";
                        shot_process_list = shot_process_list + "<li>" +self.statusIcon(status) + process + "</li>";
                    }
                }
            }

            $j('.selectable#shot_process').append(shot_process_list);

            $j('.selectable#shot_process li').on('click', function( event, ui ) {
                $j('.selectable#shot_process li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");
                self.process = $j(this).text();
                self.finalPath(production_type = 'shot', stype = stype);
                for(i=0;i<self.item_tasks.length;i++){
                    if(self.item_tasks[i]['process'] == self.process){
                        self.item_task_details = self.item_tasks[i];
                        break;
                    }
                }

            });

            selectedProcess = self.process;

            if($j('.selectable#shot_process li.ui-selected').length == 0){
                selector = '.selectable#shot_process li:contains(\"' + selectedProcess + '\")';
                if($j(selector).length == 0){
                    $j('.selectable#shot_process li')[0].addClass("ui-selected");
                } else {
                    $j(selector).addClass("ui-selected");
                }
                $j(selector).addClass("ui-selected");
                self.process = $j(selector).text();
                self.finalPath(production_type = 'shot', stype = stype);
                for(i=0;i<self.item_tasks.length;i++){
                    if(self.item_tasks[i]['process'] == self.process){
                        self.item_task_details = self.item_tasks[i];
                        break;
                    }
                }
            }
        }

        self.statusIcon = function(status){
            if(status == '.Not Ready'){
                icon = "notready.png";
            } else if(status == '.Ready'){
                icon = "ready.png";
            } else if(status == '.In Progress'){
                icon = "inprogress.png";
            } else if(status == '.Stand By'){
                icon = "standby.png";
            } else if(status == '.Review'){
                icon = "review.png";
            } else if(status == '.Complete'){
                icon = "complete.png";
            }
            return "<img src=\"/assets/scripts/adobe_scripts/icons/proc_list/" + icon + "\" class='process_status'>";
        }


        self.assetTypeCode = function(code){
            if(code == "ASSET_TYPE00002"){
                asset_type = "character";
            }
            else if(code == "ASSET_TYPE00003"){
                asset_type = "vehicle";
            }
            else if(code == "ASSET_TYPE00004"){
                asset_type = "set";
            }
            else if(code == "ASSET_TYPE00005"){
                asset_type = "prop";
            }
            else if(code == "ASSET_TYPE00006"){
                asset_type = "other";
            }
            else if(code == "3D_TYPE00002"){
                asset_type = "character";
            }
            else if(code == "3D_TYPE00003"){
                asset_type = "symbol";
            }
            else if(code == "3D_TYPE00004"){
                asset_type = "user_interface";
            }
            else if(code == "3D_TYPE00005"){
                asset_type = "bonus01";
            }
            else if(code == "3D_TYPE00006"){
                asset_type = "bonus02";
            }
            else if(code == "3D_TYPE00007"){
                asset_type = "free_game";
            }
            else if(code == "3D_TYPE00008"){
                asset_type = "jackpot";
            }
            else if(code == "3D_TYPE00009"){
                asset_type = "introduction";
            }
            else {
                asset_type = "";
            }

            return asset_type;
        }

        self.abbrName = function(inputstring){
            function hasNumbers(n) {
              return !isNaN(parseFloat(n)) && isFinite(n);
            }

            conjunction = ['and', 'the', 'or', 'of'];
            inputstring = inputstring.toLowerCase();
            inputstring = inputstring.replace(" ", "");
            words = inputstring.split("_");

            filename = "";
            if(words.length < 2){
                if(words[0].length < 5){
                    filename = words[0];
                } else {
                    filename = words[0].slice(0,3);
                }
            } else if(words.length < 3 && words[1] == "cf"){
                if(words[0].length < 5){
                    filename = words[0] + "_cf";
                } else if(words[0].length > 4){
                    filename = words[0].slice(0,3) + "_cf";
                }
            } else {
                for(i=0;i<words.length;i++){
                    if(words[i][0] == "v" && hasNumbers(words[i][1]) && hasNumbers(words[i][2])){
                        initial = "_" + words[i];
                    } else if(words[i] == "cf"){
                        initial = "_cf";
                    } else {
                        if(words[i][0] == "v"){
                            initial = words[i].slice(0,3);
                        } else if(words[i].length < 3 || (conjunction.indexOf(words[i]) == 0)){
                            initial = words[i];
                        } else{
                            initial = words[i][0];
                        }
                    }
                    filename = filename+initial;
                }
            }
            return filename;
        }

        self.abbrItemType = function(inputstring){
            inputstring = inputstring.toLowerCase();
            inputstring = inputstring.replace(" ", "");
            words = inputstring.split("_");

            item_type_name = ""
            for(i=0;i<words.length;i++){
                initial = words[i][0];
                item_type_name = item_type_name + initial;
            }
            return item_type_name;
        }

        self.maxVersion = function(base_filename){
            function getMaxOfArray(numArray) {
              return Math.max.apply(null, numArray);
            }
            versions = [];
            matchedFiles = [];
            for(i=0;i<self.file_list.length;i++){
                if(self.file_list[i]['filename'].indexOf(base_filename) > -1) {
                    matchedFiles.push(self.file_list[i]);
                }
            }


            if(self.file_list.length == 0) {
                self.next_version = "v001";
            } else {
                for(j=0;j<matchedFiles.length;j++){
                    savedFile = matchedFiles[j]['filename'].replace((base_filename + "_"), "");
                    temp = savedFile.split("_").length; /*temp is length of remaining string, find the max length for the version*/
                    version = savedFile.split(".")[0].split("_")[0];
                    version = version.replace("v","");
                    versions.push(parseInt(version));
                    self.current_version = getMaxOfArray(versions);
                    self.next_version = self.current_version + 1;
                    if(self.next_version > 9){
                        self.next_version = ("v0" + self.next_version).slice(-4);
                    } else {
                        self.next_version = ("v00" + self.next_version).slice(-4);
                    }
                    if(self.current_version > 9){
                        self.current_version = ("v0" + self.current_version).slice(-4);
                    } else {
                        self.current_version = ("v00" + self.current_version).slice(-4);
                    }
                }
            }
            return self.next_version;
        }

        self.finalPath = function(production_type, stype){
            $j('#final_path').empty();
            $j('#final_file_name').empty();
            base_path = "//art-render/art_3d_project/";


            if(self.cftype.indexOf(self.project_info['game_type']) >= 0){
                if(stype == 'assets'){
                    item_type = self.assetTypeCode(self.item_details['asset_type_code']);
                    self.final_path = base_path + self.game + "/" + stype + "/" + item_type + "/" + self.item_details['name'] + "/" + self.process + "/scenes/";
                    self.base_filename = self.abbrName(self.game) + "_" + self.abbrItemType(item_type) + "_" + self.item_details['name'] + "_" + self.abbrName(self.process);
                } else {
                    self.final_path = base_path + self.game + "/" + stype + "/" + self.item_details['name'] + "/" + self.process + "/scenes/";
                    self.base_filename = self.abbrName(self.game) + "_" + self.item_details['name'] + "_" + self.abbrName(self.process);
                }
            } else if(self.project_info['game_type'] == 'casino') {
                item_type = self.assetTypeCode(self.item_details['3d_type_code']);
                self.final_path = base_path + self.game + "/casino/" + item_type + "/" + self.item_details['name'] + "/" + self.process + "/scenes/";
                self.base_filename = self.abbrName(self.game) + "_" + self.abbrItemType(item_type) + "_" + self.item_details['name'] + "_" + self.abbrName(self.process);
            }

            $j('#final_path').val(self.final_path);
            $j('#final_path').focus();
            /*$j('#testing').val(self.final_path.replace(/\//g, '\\'));*/
            self.getFiles();
        }
        self.resetAppFilter = function(){
            $j("img.button.app").removeClass('button_on');
            $j("img.button.app").addClass('button_off');

            $j("img.button[name='AEFT']").attr('src','/assets/scripts/adobe_scripts/icons/adobe_cc_ae_icon_off.png')
            $j("img.button[name='PHXS']").attr('src','/assets/scripts/adobe_scripts/icons/adobe_cc_ps_icon_off.png')
            $j("img.button[name='ILST']").attr('src','/assets/scripts/adobe_scripts/icons/adobe_cc_ai_icon_off.png')
            $j("img.button[name='FLPR']").attr('src','/assets/scripts/adobe_scripts/icons/adobe_cc_fl_icon_off.png')
            $j("img.button[name='MAYA']").attr('src','/assets/scripts/adobe_scripts/icons/maya_icon_off.png')
            $j("img.button[name='MAX']").attr('src','/assets/scripts/adobe_scripts/icons/max_icon_off.png')
            $j("img.button[name='NUKE']").attr('src','/assets/scripts/adobe_scripts/icons/nuke_icon_off.png')

        }


        self.getFiles = function(){
            appFilter = $j("img.app.button_on").attr('name');

            if(appFilter == 'AEFT'){
                ext = 'aep';
            } else if(appFilter == 'PHXS'){
                ext = 'psd';
            } else if(appFilter == 'ILST'){
                ext = 'ai';
            } else if(appFilter == 'FLPR'){
                ext = 'flv';
            } else if(appFilter == 'MAYA'){
                ext = 'mb';
            } else if(appFilter == 'MAX'){
                ext = 'max';
            } else if(appFilter == 'NUKE'){
                ext = 'nk';
            } else {
                ext = "";
            }

            if(self.appId != ''){
                selector = "img.button[name=\'" + self.appId + "\']";
                $j(selector).addClass('button_on').removeClass('button_off');
                img = $j(selector).attr('src');
                on_img = img.replace("_off.png",".png");
                $j(selector).attr('src',on_img);
            }

            new_file_list = [];
            self.file_list = [];
            $j('.selectable#files').empty();
            data = {'final_path': self.final_path, 'base_filename': self.base_filename};
            self.file_list = server.execute_python_script('/scripts/py_listdir', data).info.spt_ret_val;

            /*build list of all files OR build list based on current selected extension */
            for(i=0;i<self.file_list.length;i++){
                if(self.file_list[i]['filename'].indexOf(self.base_filename) > -1){
                    if(ext == ""){
                        new_file_list.push(self.file_list[i]);
                    }
                    //build a file list by using ext as a filter
                    else if(self.file_list[i]['filename'].indexOf(ext) > -1){
                        new_file_list.push(self.file_list[i]);
                    }
                }
            }

            self.file_list = new_file_list;
            /*file_list = self.buildList(self.file_list);*/

            flist = "";
            for(y=0;y<self.file_list.length;y++){
                    flist = flist + "<li><div class=\"datetime\">" + self.file_list[y]['filedate'] + "</div><div class=\"filename\">" + self.file_list[y]['filename'] + "</div></li>";
            }

            $j('.selectable#files').append(flist);

            self.maxVersion(self.base_filename)
            self.current_filename = self.base_filename + "_" + self.current_version + "_" + server.login;
            self.save_filename = self.base_filename + "_" + self.next_version + "_" + server.login;
            $j('#final_file_name').val(self.save_filename);

            $j('.selectable#files li').on('click', function( event, ui ) {
                $j('.selectable#files li').removeClass("ui-selected");
                $j(this).addClass("ui-selected");
            });

            if($j('ul.selectable#files').children('li').length > 0){
                $j('.selectable#files li').removeClass("ui-selected");
                $j('ul.selectable#files').children('li')[$j('ul.selectable#files').children('li').length - 1].addClass('ui-selected')
                $j('ul.selectable#files').scrollTop(200);
            }
            self.getProjectInfo();
            self.getItemInfo();
        }



        self.saveFile = function(){
            if(self.osInfo.indexOf('Mac OS X') > -1){
                final_path = self.final_path.replace("//art-render", "/Volumes")
            } else {
                final_path = self.final_path;
            }

            savePath = final_path + self.save_filename;
            script = "var saveFolder = Folder(\"" + final_path + "\");if(!saveFolder.exists) saveFolder.create();";
            CSLibrary.evalScript(script);

            script = 'app.project.save(File(\'' + savePath + '\'));';
            if(self.appId == 'AEFT'){
                script = 'app.project.save(File(\'' + savePath + '\'));';
            } else if(self.appId == 'PHXS'){
                script = 'var saveOptions = new PhotoshopSaveOptions();  app.activeDocument.saveAs(File(\'' + savePath + '\'), saveOptions, false);';
            } else if(self.appId == 'ILST'){
                script = 'var saveOptions = new IllustratorSaveOptions(); app.activeDocument.saveAs(File(\'' + savePath + '\'), saveOptions, false);';
            }

            if(self.appId != ''){
                CSLibrary.evalScript(script, function(res){
                    t = res;
                    self.getFiles();
                });
            } else {
                alert('ok');
            }
        }

        self.openFolder = function(){
            var script = 'Folder(\"' + self.final_path + '\").execute();'
            if(self.appId != ''){
                CSLibrary.evalScript(script, function(res){
                });
            } else {
                alert('ok');
            }
        }

        //very hacky, can't upload with js api, not sure what todo with html5upload
        self.uploadTactic = function(){
            var current_filename = self.current_filename;
            current_path = self.final_path;
            t = new Date();
            date_folder = t.getFullYear() + ("0" + (t.getMonth() + 1)).slice(-2) + ("0" + t.getDate()).slice(-2);
            project_name = self.project_info['name'];
            if(self.osInfo.indexOf('Mac OS X') > -1){
                qc_path = "/Volumes/art_3d_project/" + project_name + "/qc/" + date_folder ;
            } else {
                qc_path = "//art-render/art_3d_project/" + project_name + "/qc/" + date_folder ;
            }

            script = "var saveFolder = Folder(\"" + qc_path + "\");if(!saveFolder.exists) saveFolder.create();";
            CSLibrary.evalScript(script, function(){
                script = "Folder(\"" + qc_path + "\").getFiles();";
                CSLibrary.evalScript(script, function(res){
                    new_list = [];
                    files = res.split(",");
                    for(i=0;i<files.length;i++){
                        if(files[i].indexOf(current_filename) > -1){
                            new_list.push(files[i]);
                        }
                    }
                    if(new_list.length == 0) {
                        next_version = "v001";
                    } else {
                        versions = [];
                        for(j=0;j<new_list.length;j++){
                            if(self.osInfo.indexOf('Mac OS X') > -1){
                                version = new_list[j].replace((current_filename + "_"), "").replace((qc_path.replace("/Volumes","") + "/"), "");
                            }
                            else {
                                version = new_list[j].replace((current_filename + "_"), "").replace((qc_path + "/"), "");
                            }
                            version = version.split(".")[0];
                            version = version.replace("v","");
                            versions.push(parseInt(version));
                            next_version = self.getMaxOfArray(versions) + 1;

                            if(next_version > 9){
                                next_version = ("v0" + next_version).slice(-4);
                            } else {
                                next_version = ("v00" + next_version).slice(-4);
                            }
                        }
                    }

                    save_path = qc_path + "/" + current_filename.split(".")[0] + "_" + next_version + ".jpg";
                    if(self.appId == 'PHXS'){
                        script = "saveFile=File(\"" + save_path + "\"); jpgSaveOptions=new JPEGSaveOptions; jpgSaveOptions.embedColorProfile=!0; jpgSaveOptions.formatOptions=FormatOptions.STANDARDBASELINE; jpgSaveOptions.matte=MatteType.WHITE; jpgSaveOptions.quality=6; activeDocument.saveAs(saveFile,jpgSaveOptions,!0,Extension.LOWERCASE);"
                    } else if(self.appId == 'ILST'){
                        script = "saveFile=File(\"" + save_path + ".jpg" + "\"); jpgSaveOptions=new ExportOptionsJPEG(); jpgSaveOptions.antiAliasing=!0; jpgSaveOptions.artBoardClipping=!0; app.activeDocument.exportFile(saveFile, ExportType.JPEG , jpgSaveOptions);"                    
                    }
                    CSLibrary.evalScript(script, function(){
                        sk = self.item_task_details['__search_key__'];
                        process = self.process;
                        if(self.osInfo.indexOf('Mac OS X') > -1){
                            data = {'save_path': save_path.replace("/Volumes","//art-render"), 'sk': sk, 'process':self.process}
                        }
                        else {
                            data = {'save_path': save_path, 'sk': sk, 'process':self.process}
                        }
                        $j('#testing').val(save_path);

                        server.execute_python_script('/scripts/py_checkin', data);
                    });
                });
            });
        }

        self.getMaxOfArray = function(numArray) {
              return Math.max.apply(null, numArray);
        }

        self.uploadQc = function(){
            var current_filename = self.current_filename;
            current_path = self.final_path;
            t = new Date();
            date_folder = t.getFullYear() + ("0" + (t.getMonth() + 1)).slice(-2) + ("0" + t.getDate()).slice(-2);
            project_name = self.project_info['name'];
            if(self.osInfo.indexOf('Mac OS X') > -1){
                qc_path = "/Volumes/art_3d_project/" + project_name + "/qc/" + date_folder ;
            } else {
                qc_path = "//art-render/art_3d_project/" + project_name + "/qc/" + date_folder ;
            }

            script = "var saveFolder = Folder(\"" + qc_path + "\");if(!saveFolder.exists) saveFolder.create();";
            CSLibrary.evalScript(script, function(){
                script = "Folder(\"" + qc_path + "\").getFiles();";
                CSLibrary.evalScript(script, function(res){
                    new_list = [];
                    files = res.split(",");
                    for(i=0;i<files.length;i++){
                        if(files[i].indexOf(current_filename) > -1){
                            new_list.push(files[i]);
                        }
                    }
                    if(new_list.length == 0) {
                        next_version = "v001";
                    } else {
                        versions = [];
                        for(j=0;j<new_list.length;j++){
                            if(self.osInfo.indexOf('Mac OS X') > -1){
                                version = new_list[j].replace((current_filename + "_"), "").replace((qc_path.replace("/Volumes","") + "/"), "");
                            }
                            else {
                                version = new_list[j].replace((current_filename + "_"), "").replace((qc_path + "/"), "");
                            }
                            version = version.split(".")[0];
                            version = version.replace("v","");
                            versions.push(parseInt(version));
                            next_version = self.getMaxOfArray(versions) + 1;

                            if(next_version > 9){
                                next_version = ("v0" + next_version).slice(-4);
                            } else {
                                next_version = ("v00" + next_version).slice(-4);
                            }
                        }
                    }

                    save_path = qc_path + "/" + current_filename.split(".")[0] + "_" + next_version + ".jpg";
                    if(self.appId == 'PHXS'){
                        script = "saveFile=File(\"" + save_path + "\"); jpgSaveOptions=new JPEGSaveOptions; jpgSaveOptions.embedColorProfile=!0; jpgSaveOptions.formatOptions=FormatOptions.STANDARDBASELINE; jpgSaveOptions.matte=MatteType.WHITE; jpgSaveOptions.quality=6; activeDocument.saveAs(saveFile,jpgSaveOptions,!0,Extension.LOWERCASE);"
                    } else if(self.appId == 'ILST'){
                        script = "saveFile=File(\"" + save_path + ".jpg" + "\"); jpgSaveOptions=new ExportOptionsJPEG(); jpgSaveOptions.antiAliasing=!0; jpgSaveOptions.artBoardClipping=!0; app.activeDocument.exportFile(saveFile, ExportType.JPEG , jpgSaveOptions);"                    
                    }
                    CSLibrary.evalScript(script);
                });
            });
        }

        self.openQc = function(){
            current_path = self.final_path;
            t = new Date();
            date_folder = t.getFullYear() + ("0" + (t.getMonth() + 1)).slice(-2) + ("0" + t.getDate()).slice(-2);
            project_name = self.project_info['name'];

            if(self.osInfo.indexOf('Mac OS X') > -1){
                qc_path = "/Volumes/art_3d_project/" + project_name + "/qc/" + date_folder ;
            } else {
                qc_path = "//art-render/art_3d_project/" + project_name + "/qc/" + date_folder ;
            }
            var script = 'Folder(\"' + qc_path + '\").execute();';
            CSLibrary.evalScript(script);
        }


        self.getProjectInfo = function(){
            $j('#game_name_chn').text(self.project_info['game_name_chn']);
            $j('#game_type').text(self.project_info['game_type']);
            $j('#game_assigned').text(self.project_info['assigned']);
            $j('#game_bsd').text(self.project_info['bsd']);
            $j('#game_bed').text(self.project_info['bed']);
        }

        self.formatDate = function(datestring){
            temp = new Date(datestring);
            year = temp.getFullYear();
            month = temp.getMonth() + 1;
            day = temp.getDate();
            datestring = ("0" + month).slice(-2) + "/" + ("0" + day).slice(-2) + "/" + year;
            return datestring;
        }

        self.getItemInfo = function(){
            bsd = self.formatDate(self.item_task_details['bid_start_date']);
            bed = self.formatDate(self.item_task_details['bid_end_date']);
            $j('#item_name_chn').text(self.item_details['description']);
            $j('#item_type').text(self.assetTypeCode(self.item_details['3d_type_code']))
            $j('#item_task_assigned').text(self.item_task_details['assigned']);
            $j('#item_task_bsd').text(bsd);
            $j('#item_task_bed').text(bed);
        }

        self.openFile = function(){
            selectedFile = $j('.selectable#files .ui-selected').children('div.filename').text();
            openPath = self.final_path + selectedFile;

            if(self.osInfo.indexOf('Mac OS X') > -1){
                openPath = openPath.replace("//art-render", "/Volumes")
            }
            if(self.appId == 'AEFT' || self.appId == 'PHXS' || self.appId == 'ILST'){
                script = 'app.open(File(\'' + openPath + '\'));';
            }
            CSLibrary.evalScript(script);
        }

        self.setAppId = function(){
            try{
                self.osInfo = CSLibrary.getOSInformation();
                self.appId = CSLibrary.getHostEnvironment().appId;
                if(tacticUI.appId == 'PHXS'){
                    $j("img.button[name='PHXS']").addClass('button_on').removeClass('button_off');
                } else if(tacticUI.appId == 'AEFT'){
                    $j("img.button[name='AEFT']").addClass('button_on').removeClass('button_off');
                } else if(tacticUI.appId == 'ILST'){
                    $j("img.button[name='ILST']").addClass('button_on').removeClass('button_off');
                } else if(tacticUI.appId == 'FLPR'){
                    $j("img.button[name='FLPR']").addClass('button_on').removeClass('button_off');
                }
            }catch(err){

            }
        }
    }
</script>

</body>

</html

